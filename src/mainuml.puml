@startuml Main
left to right direction
skinparam packageStyle rectangle

' Configurazione colori e stili per pulizia
skinparam usecase {
    BackgroundColor White
    BorderColor DarkSlateGray
    ArrowColor Black
}
skinparam rectangle {
    BorderColor Black
    BackgroundColor WhiteSmoke
}

' --- ATTORI ---
actor "Cicloturista" as User
actor "Ente Pubblico" as Ente
actor "Admin Piattaforma" as Admin 

rectangle "Piattaforma Cicloturismo" {

    ' --- SB0: AUTENTICAZIONE ---
    rectangle "SB0 - Autenticazione" as SB0 {
        usecase "RF0.2 - Login" as RF0_2
        usecase "RF0.0 - Registrazione\ncicloturista" as RF0_0
        usecase "RF0.1 - Registrazione\nutente privilegiato" as RF0_1
        usecase "RF0.2.0 - Login provider\nesterni" as RF0_2_0
        
        ' Relazioni interne SB0
        RF0_2_0 .> RF0_2 : <<extend>>
    }

    ' --- SB1: SEGNALAZIONI ---
    rectangle "SB1 - Segnalazioni" as SB1 {
        usecase "RF1.0 - Creazione\nsegnalazione" as RF1_0
        usecase "RF1.1 - Invio\nnotifiche" as RF1_1
        
        ' Relazioni interne SB1
        RF1_1 .> RF1_0 : <<include>>
    }

    ' --- SB2: ESPLORAZIONE & ITINERARI ---
    rectangle "SB2 - Esplorazione percorsi" as SB2 {
        
        ' Sottogruppo Mappa
        package "Visualizzazione" {
            usecase "RF2.0 - Visualizzatore mappa" as RF2_0
            usecase "RF2.1 - POI" as RF2_1
            usecase "RF2.7 - Audiodescrizione" as RF2_7
            usecase "RF3 - Meteo area" as RF3
        }

        ' Sottogruppo Community
        package "Community e Bacheche" {
            usecase "RF2.2 - Bacheca itinerari" as RF2_2
            usecase "RF4 - Bacheca Eventi" as RF4
            usecase "RF2.6 - Inserimento\nrecensione" as RF2_6
        }
        
        ' Sottogruppo Gestione Itinerari
        package "Gestione Itinerari" {
            usecase "RF2.3 - Creazione itinerari\n(Base esistente)" as RF2_3
            usecase "RF2.3.0 - Copia privata" as RF2_3_0
            usecase "RF2.3.1 - Modifica privata" as RF2_3_1
            usecase "RF2.3.2 - Pubblicazione" as RF2_3_2
            usecase "RF2.4 - Creazione itinerari\n(Recording)" as RF2_4
            usecase "RF2.5 - Gestione storico" as RF2_5
        }
        
        usecase "RF5 - Raccolta dati" as RF5

        ' Relazioni interne SB2 (Visualizzazione)
        RF2_1 .up.> RF2_0 : <<extend>>
        RF2_7 .up.> RF2_0 : <<extend>>
        RF3 .up.> RF2_0 : <<extend>>

        ' Relazioni interne SB2 (Itinerari)
        RF2_3 .up.> RF2_2 : <<extend>>
        RF2_6 .up.> RF2_2 : <<extend>>
        
        RF2_3_0 .up.> RF2_3 : <<include>>
        RF2_3_1 .up.> RF2_3 : <<include>>
        RF2_3_2 .down.> RF2_3 : <<extend>>
    }
}

' --- RELAZIONI ESTERNE ---

' Cicloturista (Sinistra)
User --> RF0_0
User --> RF0_2
User --> RF2_0
User --> RF2_2
User --> RF1_0
User --> RF2_4
User --> RF2_5

' Ente Pubblico (Sinistra)
Ente --> RF0_2
Ente --> RF4
Ente --> RF1_0

' Admin (Destra)
RF0_1 <-- Admin
RF0_2 <-- Admin
RF5 <-- Admin
RF1_1 <-- Admin

' Layout hints (Ora funzionano sui rettangoli, non creano attori)
SB0 -[hidden]down- SB1
SB1 -[hidden]down- SB2

@enduml